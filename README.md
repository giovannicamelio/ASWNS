@author Giovanni Camelio
@date 2022-05-19
@note this repository is a copy of [Camelio (2022), "ASWNS", zenodo, https://doi.org/10.5281/zenodo.6594069](https://zenodo.org/record/6594069)

# Description

ASWNS ("Arcetri-Stockholm-Warsaw Neutron Star", from the names of the cities where it has been developed) is a FORTRAN 90 code that solves for the structure of rotating neutron stars in the "eXtended Conformal Flatness Condition" (XCFC) approximation of general relativity.
It assumes stationarity, axisymmetry, and circularity (the matter motion is purely toroidal).
The neutron star can be in rigid or differential rotation, cold or hot, barotropic (i.e. the equation of state is effectively barotropic) or nonbarotropic (i.e. baroclinic).

ASWNS is a fork of the XNS-v2 code described in [Bucciantini & Del Zanna (2011)][Buc11] and [Pili et al. (2014)][Pil14] and has been used in [Camelio et al. (2018)][Cam18] to determine the mass that would escape black hole formation after the collapse of a cold neutron star in rigid rotation at the Keplerian limit, in [Camelio et al. (2019)][Cam19] to break the assumption of effectively barotropic neutron star, and in [Camelio et al. (2021)][Cam21] to model the hot, nonbarotropic, and differentially rotating binary neutron star merger remnant.
Contrary to XNS-v2, ASWNS employs the [self-consistent-field method][Gou11], it does not assume a barotropic equation of state and therefore the star can be [nonbarotropic][Cam19], and it does not solve for [magnetic configurations][Pil14].

Note that the published version of the code ASWNS is not exactly the same used in Camelio et al. ([2018][Cam18], [2019][Cam19], [2021][Cam21]), but it is very similar to the latter (i.e. [Camelio et al. 2021][Cam21]), even if the examples of usage of ASWNS are based on [Camelio et al. (2018)][Cam18] and [Camelio et al. (2019)][Cam19].
I decided not to provide the implementation of the model of the merger remnant of [Camelio et al. (2021)][Cam21] not to obscure with technical complications the structure of the code.
You can implement any neutron star model on top of ASWNS, as shown in the examples provided.

For a detailed account on rotating neutron stars in general relativity see [Gourgoulhon (2011)][Gou11].
The XCFC approximation was introduced by [Cordero-Carrión et al. (2009)][Cor09] and specified for axisymmetric spacetimes by [Bucciantini & Del Zanna (2011)][Buc11].
The metric of the neutron star is determined by solving the angular part with spectral methods and solving the radial part with matrix inversion, as explained in [Bucciantini & Del Zanna (2011)][Buc11].
The thermodynamic condition of the fluid is determined by solving the force balance equation as explained in [Camelio et al. (2019)][Cam19].

# Authors and license

XNS-v2 was developed by Niccolò Bucciantini, Luca Del Zanna, and Antonio Pili at Arcetri (INAF and University of Florence), under the EU:FP7 NSMAG Grant Program.

ASWNS was developed by Giovanni Camelio at the Stockholm University and at the Nicolaus Copernicus Astronomical Center of the Polish Academy of Science CAMK-PAN (Warsaw, Poland), under the Polish National Science Center (NCN) grant number OPUS 2019/33/B/ST9/00942.

ASWNS is released under the [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License (CC BY-NC-SA 4.0)](http://creativecommons.org/licenses/by-nc-sa/4.0/).

If you use ASWNS, please cite:

* [Bucciantini & Del Zanna (2011), A&A 528:A101][Buc11]
* [Pili et al. (2014), MNRAS 439:3541][Pil14]
* [Camelio et al. (2018), MNRAS 480:5272][Cam18]
* [Camelio et al. (2019), PRD 100:123001][Cam19]
* [Camelio et al. (2021), PRD 103:063014][Cam21]

# Content

* `README.md` -- this documentation file
* `ASWNS.f90` -- ASWNS code
* `kepler.f90` -- example of usage of ASWNS for determining the Keplerian curve of a cold and rigidly rotating neutron star, based on [Camelio et al. (2018)][Cam18] but with a simpler equation of state
* `nonbarotropic.f90` -- example of usage of ASWNS for determining the structure of a nonbarotropic neutron star, based on [Camelio et al. (2019)][Cam19]
* `binfile_reader.py` -- a script to read the stellar profiles in the binary output generated by `nonbarotropic.f90`
* `Doxyfile`-- configuration file for generating the automatic documentation with Doxygen

# Usage

`nonbarotropic.f90` and `kepler.f90` are examples of programs that deploy the ASWNS code contained in `ASWNS.f90`: `nonbarotropic.f90` generates a configuration similar to the nonbarotropic, convective one in [Camelio et al. (2019)][Cam19], while `kepler.f90` produces the Keplerian curve of the rigid rotating, cold neutron star with a Γ=3 polytrope (i.e. Fig. 5 of [Camelio et al. 2019][Cam19]).
Experimenting with these examples, you may want to adjust the grid settings in `ASWNS.f90`, which are not equivalent to those of [Camelio et al. (2019)][Cam19].

In general, in order to determine a rotating model you should first initialize the grid and other working quantities and arrays by calling the `system::ns_init` subroutine.
You may also want to call your own initialization subroutine at this stage, e.g. to initialize your equation of state.
You can now determine the structure of the rotating star by calling the `system::ns_solve` subroutine.
After this, you may want to compute some derived quantities with the `system::compute_quantities` and `system::get_m0_stot` subroutines.

ASWNS uses the `DGTSV` subroutine from [LAPACK](http://www.netlib.org/lapack/double/), which can be downloaded together with its dependency (the `XERBLA` subroutine) at this [link](http://www.netlib.org/cgi-bin/netlibfiles.pl?filename=/lapack/double/dgtsv.f).
Below I assume that the `DGTSV` subroutine and its dependency are contained in the `dgtsv_and_xerbla.f` file.
If you already have LAPACK installed, you can substitute in the compilation the `dgtsv_and_xerbla.f` file with the flag `-llapack`.

To compile with `gfortran` and run the code on a Linux machine, execute in a bash shell:

```
$ gfortran -O2 ASWNS.f90 nonbarotropic.f90 dgtsv_and_xerbla.f -o nonbarotropic.x
$ ./nonbarotropic.x
```
and / or:
```
$ gfortran -O2 ASWNS.f90 kepler.f90 dgtsv_and_xerbla.f -o kepler.x
$ ./kepler.x
```
In case the grid size is too big, you will need to tweak some compilation flags, for example adding `-mcmodel=medium` (to be on the safe side, you can always include this flag).

To generate the automatic documentation with Doxygen, execute:
```
$ doxygen
```
To read the automatic documentation, open the file `html/index.html` in a browser.
Note that in order to see the call/caller graphs for each function you need the `dot` tool from the `graphviz` package.

To convert the binary output of `nonbarotropic.f90` to (gnuplot-friendly) text format, you can use `binfile_reader.py`:
```
$ python3
>>> from binfile_reader import *
>>> bin2dat(binstar('star.out'),'star.dat')
```

# Outlooks

ASWNS can be the starting point for several interesting projects, for example:

* drop the XCFC approximation and use "full" general relativity instead
* apply the method developed in [Camelio et al. (2019)][Cam19] to solve the force balance equation for nonbarotropic configurations also to other physical systems, like post hadron-quark phase transition stars, accretion disks, and Newtonian stars
* generalize the method developed in [Camelio et al. (2019)][Cam19] to solve the force balance equation for nonbarotropic configurations:
   * with magnetic fields (see e.g. [Pili et al. 2014][Pil14])
   * with meridional flows (see e.g. [Birkl et al. 2011][Bir11])
   * with one or more independent species in the equation of state (see discussion in Sec. VI.C of [Camelio et al. 2019][Cam19])
   * without the assumption of planar configurations (see discussion in Sec. VI.B of [Camelio et al. 2019][Cam19])
* apply the techniques developed in the context of Newtonian Stars (see references in Sec. VII of [Camelio et al. 2019][Cam19]) to determine the configuration of a nonbarotropic rotating neutron star with a completely arbitrary thermal profile
* use the method developed in the previous point to determine the neutrino-driven, quasi-stationary evolution of a hot and rotating neutron star born from a supernova or binary neutron star merger, also determining the neutrino and gravitational wave emission (see e.g. [Miralles et al. 1993][Mir93], [Camelio et al. 2017][Cam17], and [Krüger and Kokkotas 2020][Kru20])

I will likely never have time to carry on these projects and I would be happy if somebody finds them interesting and decides to pursue them.

# Contact

If you have doubts about ASWNS, try first to:

* learn Fortran 90,
* understand the theory behind rotating neutron stars (e.g., study the excellent notes of [Gourghoulon 2011][Gou11]),
* read the relevant papers (i.e. [Cordero-Carrión et al. 2009][Cor09], [Bucciantini & Del Zanna 2011][Buc11], [Pili et al. 2014][Pil14], [Camelio et al. 2018][Cam18], [2019][Cam19], [2021][Cam21]),
* look at the automatic documentation generated by Doxygen.

If you still have doubts, you can write me an email.
You should be able to find my most recent email address through arXiv.

If you find a bug in the code or an error in the equations, please let me know.

# References

* [Birkl, Stergioulas & Müller (2011), "Stationary, axisymmetric neutron stars with meridional circulation in general relativity", PRD 84:023003, arXiv:1011.5475][Bir11]
* [Bucciantini & Del Zanna (2011), "General relativistic magnetohydrodynamics in axisymmetric dynamical spacetimes: the X-ECHO code", A&A 528:A101, arXiv:1010.3532][Buc11]
* [Camelio, Lovato, Gualtieri, Benhar, Pons & Ferrari (2017), "Evolution of a proto-neutron star with a nuclear many-body equation of state: Neutrino luminosity and gravitational wave frequencies", PRD 96:043015, arXiv:1704.01923][Cam17]
* [Camelio, Dietrich & Rosswog (2018), "Disc formation in the collapse of supramassive neutron stars", MNRAS 480:5272, arXiv:1806.07775][Cam18]
* [Camelio, Dietrich, Marques & Rosswog (2019), "Rotating neutron stars with nonbarotropic thermal profile", PRD 100:123001, arXiv:1908.11258][Cam19]
* [Camelio, Dietrich, Rosswog & Haskell (2021), "Axisymmetric models for neutron star merger remnants with realistic thermal and rotational profiles", PRD 103:063014, arXiv:2011.10557][Cam21]
* [Cordero-Carrión, Cerdá-Durán, Dimmelmeier, Jaramillo, Novak & Gourgoulhon (2009), "Improved constrained scheme for the Einstein equations: An approach to the uniqueness issue", PRD 79:024017, arXiv:0809.2325][Cor09]
* [Gourgoulhon (2011), "An introduction to the theory of rotating neutron stars", arXiv:1003.5015v2][Gou11]
* [Krüger & Kokkotas (2020), "Dynamics of fast rotating neutron stars: An approach in the Hilbert gauge", PRD 102:064026, arXiv:2008.04127][Kru20]
* [Miralles, van Riper & Lattimer (1993), "The Boltzmann equation in general relativistic rotating systems: cooling of rotating neutron stars", ApJ 407:687][Mir93]
* [Pili, Bucciantini & Del Zanna (2014), "Axisymmetric equilibrium models for magnetized neutron stars in General Relativity under the Conformally Flat Condition", MNRAS 439:3541, arXiv:1401.4308][Pil14]

[Mir93]: https://articles.adsabs.harvard.edu/pdf/1993ApJ...407..687M
[Cor09]: https://journals.aps.org/prd/abstract/10.1103/PhysRevD.79.024017
[Bir11]: https://journals.aps.org/prd/abstract/10.1103/PhysRevD.84.023003
[Gou11]: https://arxiv.org/abs/1003.5015
[Buc11]: https://www.aanda.org/articles/aa/full_html/2011/04/aa15945-10/aa15945-10.html
[Pil14]: https://academic.oup.com/mnras/article/439/4/3541/1161070
[Cam17]: https://journals.aps.org/prd/abstract/10.1103/PhysRevD.96.043015
[Cam18]: https://academic.oup.com/mnras/article/480/4/5272/5068715
[Cam19]: https://journals.aps.org/prd/abstract/10.1103/PhysRevD.100.123001
[Kru20]: https://journals.aps.org/prd/abstract/10.1103/PhysRevD.102.064026
[Cam21]: https://journals.aps.org/prd/abstract/10.1103/PhysRevD.103.063014
